<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="./test/css/swiper.min.css">
  <link rel="stylesheet" href="./css/theme.css" />
  <link rel="stylesheet" href="./css/comm.css" />
  <link rel="stylesheet" href="./css/uk-index.css" />
  <script src="./test/js/swiper.min.js"></script>
</head>

<body>
  <div class="expenditures">
    <div class="container">
      <div class="expenditures-cont">
        <h3 class="expenditures-h3"> IPL pays for itself.</h3>
        <div class="expenditures-sub">Your hair removal method:</div>
        <div class="expenditures-tab-cont">
          <div class="expenditures-tab">
            <div class="expenditures-tab-item active" data-type="0">Armpit</div>
            <div class="expenditures-tab-item" data-type="1">face</div>
            <div class="expenditures-tab-item" data-type="0">Armpit</div>
            <div class="expenditures-tab-item" data-type="1">face</div>
            <div class="expenditures-tab-item" data-type="0">Armpit</div>
          </div>
        </div>
        <h4 class="expenditures-h4">Your monthly spend on hair removal: </h4>
        <input type="number" name="number" min="0" max="2000" placeholder="£" class="expenditures-num">
        <div class="expenditures-btn">Calculate</div>
      </div>
      <div class="expenditures-dispatch">
        <h3 class="expenditures-h3"> Your IPL savings start here.</h3>
        <div class="expenditures-dispatch-top">
          Based on your current hair removal method: <span>Cream (£15/month)</span>
        </div>
        <div class="expenditures-dispatch-cont">
          <div class="expenditures-dispatch-num">
            <div class="expenditures-dispatch-m">
              You’ll break even in just <strong>9.3 months</strong>,
            </div>
            <div class="expenditures-dispatch-y">
              <strong>save up to £360/year</strong> after that.
            </div>
          </div>
          <div class="expenditures-dispatch-list">
            <div class="expenditures-dispatch-item">
              <div class="expenditures-dispatch-l">
                <svg xmlns="http://www.w3.org/2000/svg" width="23" height="22" viewBox="0 0 23 22" fill="none">
                  <path fill-rule="evenodd" clip-rule="evenodd"
                    d="M9.1839 1.10327C11.3181 0.621082 13.5509 0.841689 15.5494 1.73219L15.9028 1.88964L16.2177 1.1829C16.2177 1.1829 18.0153 1.98385 15.8644 1.02544C13.7134 0.0670405 11.3103 -0.170389 9.01339 0.348567C6.71648 0.867522 4.64887 2.11506 3.11891 3.90511C1.58894 5.69517 0.678609 7.93183 0.523671 10.2815C0.368733 12.6312 0.977492 14.9681 2.25916 16.9435C3.54082 18.919 5.42673 20.4272 7.6356 21.2433C9.84447 22.0593 12.258 22.1395 14.5161 21.4718C16.7743 20.8042 18.7561 19.4244 20.1661 17.5384C21.576 15.6524 22.3385 13.3611 22.3399 11.0063L22.3399 10.6506L22.3399 10.4239C22.3399 9.99655 21.9935 9.65014 21.5661 9.65014L21.5662 10.6506L21.5661 11.0058C21.5649 13.1938 20.8564 15.3227 19.5464 17.0751C18.2363 18.8275 16.3949 20.1095 14.2967 20.7299C12.1986 21.3502 9.9561 21.2757 7.90373 20.5175C5.85137 19.7592 4.09909 18.3579 2.90824 16.5224C1.71738 14.6869 1.15176 12.5157 1.29572 10.3324C1.43968 8.14923 2.28551 6.07104 3.70707 4.40782C5.12863 2.74459 7.04974 1.58545 9.1839 1.10327ZM22.2266 2.85317L22.5 2.57949L21.9526 2.03265L21.6792 2.30634L11.4197 12.5761L10.4123 11.5688L8.80701 9.96345C8.50485 9.66129 8.01496 9.66129 7.7128 9.96345L9.86524 12.1159L11.1463 13.3969C11.2188 13.4695 11.3173 13.5103 11.4199 13.5102C11.5226 13.5102 11.621 13.4694 11.6935 13.3968L22.2266 2.85317Z"
                    fill="#E0004D" />
                </svg>
                No more ouch — or sticky mess
              </div>
              <div class="expenditures-dispatch-l">
                <svg xmlns="http://www.w3.org/2000/svg" width="23" height="22" viewBox="0 0 23 22" fill="none">
                  <path fill-rule="evenodd" clip-rule="evenodd"
                    d="M9.1839 1.10327C11.3181 0.621082 13.5509 0.841689 15.5494 1.73219L15.9028 1.88964L16.2177 1.1829C16.2177 1.1829 18.0153 1.98385 15.8644 1.02544C13.7134 0.0670405 11.3103 -0.170389 9.01339 0.348567C6.71648 0.867522 4.64887 2.11506 3.11891 3.90511C1.58894 5.69517 0.678609 7.93183 0.523671 10.2815C0.368733 12.6312 0.977492 14.9681 2.25916 16.9435C3.54082 18.919 5.42673 20.4272 7.6356 21.2433C9.84447 22.0593 12.258 22.1395 14.5161 21.4718C16.7743 20.8042 18.7561 19.4244 20.1661 17.5384C21.576 15.6524 22.3385 13.3611 22.3399 11.0063L22.3399 10.6506L22.3399 10.4239C22.3399 9.99655 21.9935 9.65014 21.5661 9.65014L21.5662 10.6506L21.5661 11.0058C21.5649 13.1938 20.8564 15.3227 19.5464 17.0751C18.2363 18.8275 16.3949 20.1095 14.2967 20.7299C12.1986 21.3502 9.9561 21.2757 7.90373 20.5175C5.85137 19.7592 4.09909 18.3579 2.90824 16.5224C1.71738 14.6869 1.15176 12.5157 1.29572 10.3324C1.43968 8.14923 2.28551 6.07104 3.70707 4.40782C5.12863 2.74459 7.04974 1.58545 9.1839 1.10327ZM22.2266 2.85317L22.5 2.57949L21.9526 2.03265L21.6792 2.30634L11.4197 12.5761L10.4123 11.5688L8.80701 9.96345C8.50485 9.66129 8.01496 9.66129 7.7128 9.96345L9.86524 12.1159L11.1463 13.3969C11.2188 13.4695 11.3173 13.5103 11.4199 13.5102C11.5226 13.5102 11.621 13.4694 11.6935 13.3968L22.2266 2.85317Z"
                    fill="#E0004D" />
                </svg>
                No waiting around for regrowth
              </div>
              <div class="expenditures-dispatch-l">
                <svg xmlns="http://www.w3.org/2000/svg" width="23" height="22" viewBox="0 0 23 22" fill="none">
                  <path fill-rule="evenodd" clip-rule="evenodd"
                    d="M9.1839 1.10327C11.3181 0.621082 13.5509 0.841689 15.5494 1.73219L15.9028 1.88964L16.2177 1.1829C16.2177 1.1829 18.0153 1.98385 15.8644 1.02544C13.7134 0.0670405 11.3103 -0.170389 9.01339 0.348567C6.71648 0.867522 4.64887 2.11506 3.11891 3.90511C1.58894 5.69517 0.678609 7.93183 0.523671 10.2815C0.368733 12.6312 0.977492 14.9681 2.25916 16.9435C3.54082 18.919 5.42673 20.4272 7.6356 21.2433C9.84447 22.0593 12.258 22.1395 14.5161 21.4718C16.7743 20.8042 18.7561 19.4244 20.1661 17.5384C21.576 15.6524 22.3385 13.3611 22.3399 11.0063L22.3399 10.6506L22.3399 10.4239C22.3399 9.99655 21.9935 9.65014 21.5661 9.65014L21.5662 10.6506L21.5661 11.0058C21.5649 13.1938 20.8564 15.3227 19.5464 17.0751C18.2363 18.8275 16.3949 20.1095 14.2967 20.7299C12.1986 21.3502 9.9561 21.2757 7.90373 20.5175C5.85137 19.7592 4.09909 18.3579 2.90824 16.5224C1.71738 14.6869 1.15176 12.5157 1.29572 10.3324C1.43968 8.14923 2.28551 6.07104 3.70707 4.40782C5.12863 2.74459 7.04974 1.58545 9.1839 1.10327ZM22.2266 2.85317L22.5 2.57949L21.9526 2.03265L21.6792 2.30634L11.4197 12.5761L10.4123 11.5688L8.80701 9.96345C8.50485 9.66129 8.01496 9.66129 7.7128 9.96345L9.86524 12.1159L11.1463 13.3969C11.2188 13.4695 11.3173 13.5103 11.4199 13.5102C11.5226 13.5102 11.621 13.4694 11.6935 13.3968L22.2266 2.85317Z"
                    fill="#E0004D" />
                </svg>
                Smooth skin without the salon trip
              </div>
              <div class="expenditures-dispatch-l">
                <svg xmlns="http://www.w3.org/2000/svg" width="23" height="22" viewBox="0 0 23 22" fill="none">
                  <path fill-rule="evenodd" clip-rule="evenodd"
                    d="M9.1839 1.10327C11.3181 0.621082 13.5509 0.841689 15.5494 1.73219L15.9028 1.88964L16.2177 1.1829C16.2177 1.1829 18.0153 1.98385 15.8644 1.02544C13.7134 0.0670405 11.3103 -0.170389 9.01339 0.348567C6.71648 0.867522 4.64887 2.11506 3.11891 3.90511C1.58894 5.69517 0.678609 7.93183 0.523671 10.2815C0.368733 12.6312 0.977492 14.9681 2.25916 16.9435C3.54082 18.919 5.42673 20.4272 7.6356 21.2433C9.84447 22.0593 12.258 22.1395 14.5161 21.4718C16.7743 20.8042 18.7561 19.4244 20.1661 17.5384C21.576 15.6524 22.3385 13.3611 22.3399 11.0063L22.3399 10.6506L22.3399 10.4239C22.3399 9.99655 21.9935 9.65014 21.5661 9.65014L21.5662 10.6506L21.5661 11.0058C21.5649 13.1938 20.8564 15.3227 19.5464 17.0751C18.2363 18.8275 16.3949 20.1095 14.2967 20.7299C12.1986 21.3502 9.9561 21.2757 7.90373 20.5175C5.85137 19.7592 4.09909 18.3579 2.90824 16.5224C1.71738 14.6869 1.15176 12.5157 1.29572 10.3324C1.43968 8.14923 2.28551 6.07104 3.70707 4.40782C5.12863 2.74459 7.04974 1.58545 9.1839 1.10327ZM22.2266 2.85317L22.5 2.57949L21.9526 2.03265L21.6792 2.30634L11.4197 12.5761L10.4123 11.5688L8.80701 9.96345C8.50485 9.66129 8.01496 9.66129 7.7128 9.96345L9.86524 12.1159L11.1463 13.3969C11.2188 13.4695 11.3173 13.5103 11.4199 13.5102C11.5226 13.5102 11.621 13.4694 11.6935 13.3968L22.2266 2.85317Z"
                    fill="#E0004D" />
                </svg>
                Skip salon costs and awkward visits
              </div>
            </div>
          </div>
          <div class="expenditures-dispatch-product">
            <div class="expenditures-dispatch-arraws">
              <div class="expenditures-dispatch-arraw expenditures-dispatch-left">
                <svg xmlns="http://www.w3.org/2000/svg" width="56" height="56" viewBox="0 0 56 56" fill="none">
                  <circle cx="28" cy="28" r="28" transform="rotate(-180 28 28)" fill="#FBFAF4" />
                  <path fill-rule="evenodd" clip-rule="evenodd"
                    d="M33.0404 46.2929L33.7475 47L35.1617 45.5858L34.4546 44.8787L27.9989 38.423L21.9137 32.3377C21.1326 31.5567 19.8663 31.5567 19.0852 32.3377L26.5847 39.8372L33.0404 46.2929ZM15.5404 27.3787C15.1499 27.7692 15.1499 28.4024 15.5404 28.7929C15.6719 28.9244 15.8309 29.0116 15.9989 29.0546L15.9989 29.0858L16.2453 29.0858L16.2497 29.0858L16.9989 29.0858L27.2494 29.0858L37.5 29.0858L40.0001 29.0858C41.1046 29.0858 42.0001 28.1904 42.0001 27.0858L37.5 27.0858L18.6617 27.0858L34.4546 11.2929L35.1617 10.5858L33.7475 9.17158L33.0404 9.87868L15.5404 27.3787Z"
                    fill="#190A0A" />
                </svg>
              </div>
              <div class="expenditures-dispatch-arraw expenditures-dispatch-right">
                <svg xmlns="http://www.w3.org/2000/svg" width="56" height="56" viewBox="0 0 56 56" fill="none">
                  <circle cx="28" cy="28" r="28" transform="matrix(1 -8.74228e-08 -8.74228e-08 -1 0 56)"
                    fill="#FBFAF4" />
                  <path fill-rule="evenodd" clip-rule="evenodd"
                    d="M22.9596 46.2929L22.2525 47L20.8383 45.5858L21.5454 44.8787L28.0011 38.423L34.0863 32.3377C34.8674 31.5567 36.1337 31.5567 36.9148 32.3377L29.4153 39.8372L22.9596 46.2929ZM40.4596 27.3787C40.8501 27.7692 40.8501 28.4024 40.4596 28.7929C40.3281 28.9244 40.1691 29.0116 40.0011 29.0546L40.0011 29.0858L39.7547 29.0858L39.7503 29.0858L39.0011 29.0858L28.7506 29.0858L18.5 29.0858L15.9999 29.0858C14.8954 29.0858 13.9999 28.1904 13.9999 27.0858L18.5 27.0858L37.3383 27.0858L21.5454 11.2929L20.8383 10.5858L22.2525 9.17158L22.9596 9.87868L40.4596 27.3787Z"
                    fill="#190A0A" />
                </svg>
              </div>
            </div>
            <div class="expenditures-dispatch-product-list swiper-wrapper">
              <div class="expenditures-dispatch-product-item swiper-slide">
                <div class="expenditures-dispatch-product-img">
                  <div class="expenditures-dispatch-product-tag">HOT</div>
                  <img src="./images65/a1.jpg" alt="" loading="lazy">
                </div>
                <div class="expenditures-dispatch-product-info">
                  <h3 class="expenditures-dispatch-product-h3">Ulike Air 10 IPL hair removal device</h3>
                  <div class="expenditures-dispatch-product-price">
                    <span class="n-price">£279.99</span>
                    <span class="d-price">£299.99</span>
                  </div>
                  <div class="expenditures-dispatch-product-btn">
                    SHOP NOW
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="24" viewBox="0 0 30 24" fill="none">
                      <path d="M0.382812 12.1048L27.1818 12.1035" stroke="currentColor" stroke-width="1.24646" />
                      <path d="M21.5723 6.49414L28.1361 12.1045L21.5723 17.5727" stroke="currentColor"
                        stroke-width="1.24646" stroke-linejoin="round" />
                    </svg>
                  </div>
                </div>
              </div>
              <div class="expenditures-dispatch-product-item swiper-slide">
                <div class="expenditures-dispatch-product-img">
                  <div class="expenditures-dispatch-product-tag">HOT</div>
                  <img src="./images65/a1.jpg" alt="" loading="lazy">
                </div>
                <div class="expenditures-dispatch-product-info">
                  <h3 class="expenditures-dispatch-product-h3">Ulike Air 10 IPL hair removal device</h3>
                  <div class="expenditures-dispatch-product-price">
                    <span class="n-price">£179.99</span>
                    <span class="d-price">£299.99</span>
                  </div>
                  <div class="expenditures-dispatch-product-btn">
                    SHOP NOW
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="24" viewBox="0 0 30 24" fill="none">
                      <path d="M0.382812 12.1048L27.1818 12.1035" stroke="currentColor" stroke-width="1.24646" />
                      <path d="M21.5723 6.49414L28.1361 12.1045L21.5723 17.5727" stroke="currentColor"
                        stroke-width="1.24646" stroke-linejoin="round" />
                    </svg>
                  </div>
                </div>
              </div>
              <div class="expenditures-dispatch-product-item swiper-slide">
                <div class="expenditures-dispatch-product-img">
                  <div class="expenditures-dispatch-product-tag">HOT</div>
                  <img src="./images65/a1.jpg" alt="" loading="lazy">
                </div>
                <div class="expenditures-dispatch-product-info">
                  <h3 class="expenditures-dispatch-product-h3">Ulike Air 10 IPL hair removal device</h3>
                  <div class="expenditures-dispatch-product-price">
                    <span class="n-price">£379.99</span>
                    <span class="d-price">£299.99</span>
                  </div>
                  <div class="expenditures-dispatch-product-btn">
                    SHOP NOW
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="24" viewBox="0 0 30 24" fill="none">
                      <path d="M0.382812 12.1048L27.1818 12.1035" stroke="currentColor" stroke-width="1.24646" />
                      <path d="M21.5723 6.49414L28.1361 12.1045L21.5723 17.5727" stroke="currentColor"
                        stroke-width="1.24646" stroke-linejoin="round" />
                    </svg>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="expenditures-dispatch-btn">Recalculate</div>
      </div>
    </div>
  </div>
  <script>
    class ExpendituresController {
      constructor(wrapperSelector) {
        this.wrapper = document.querySelector(wrapperSelector);
        if (!this.wrapper) return;

        this.clickedTabIndex = null;
        this.clickedTabTxt = null;

        this.initInputControl();
        this.initTabClick();
        this.initBtnClick();
        this.initResetBtn();
      }

      initSwiper() {
        const swiperEl = this.wrapper.querySelector(".expenditures-dispatch-product");
        if (!swiperEl) return;

        this.swiper = new Swiper(swiperEl, {
          slidesPerView: "auto",
          spaceBetween: 70,
          loop: true,
          centeredSlides: true,
          navigation: {
            nextEl: this.wrapper.querySelector(".expenditures-dispatch-right"),
            prevEl: this.wrapper.querySelector(".expenditures-dispatch-left"),
          },
          on: {
            transitionEnd: () => {
              this.handleSlideChange();
            },
          },
        });
      }

      handleSlideChange() {
        const price = this.wrapper.querySelector(".swiper-slide-active .n-price").innerText;
        this.recalculateWithNewPrice(parseFloat(price.replace(/[^0-9.]/g, '') || "0"))
      }

      initInputControl() {
        const input = this.wrapper.querySelector(".expenditures-num");
        if (!input) return;

        input.addEventListener("keydown", (e) => {
          const allowedKeys = [
            "Backspace", "Delete", "ArrowLeft", "ArrowRight", "Tab", "Enter",
          ];

          if (allowedKeys.includes(e.key)) return;
          if (/^\d$/.test(e.key)) return;

          e.preventDefault();
        });

        input.addEventListener("input", () => {
          let value = input.value.replace(/[^\d]/g, "");
          let num = parseInt(value, 10);

          if (isNaN(num)) {
            input.value = "";
          } else if (num < 0) {
            input.value = "0";
          } else if (num > 2000) {
            input.value = "2000";
          } else {
            input.value = String(num);
          }
        });

        input.addEventListener("paste", (e) => {
          const pasted = e.clipboardData.getData("text");
          if (!/^\d+$/.test(pasted)) {
            e.preventDefault();
          }
        });
      }

      showToast(message) {
        // 如果已存在，先移除旧的
        const oldToast = document.getElementById('custom-toast');
        if (oldToast) oldToast.remove();

        // 创建新 DOM 元素
        const toast = document.createElement('div');
        toast.id = 'custom-toast';
        toast.textContent = message;

        // 设置样式
        Object.assign(toast.style, {
          position: 'fixed',
          top: '15%',
          left: '50%',
          transform: 'translate(-50%, 0%)',
          backgroundColor: '#e0004d',
          color: 'white',
          padding: '12px 24px',
          borderRadius: '6px',
          fontSize: '16px',
          zIndex: '9999',
          pointerEvents: 'none',
          transition: 'opacity 0.3s ease',
          opacity: '1',
        });

        // 添加到页面
        document.body.appendChild(toast);

        // 延迟 3 秒自动移除
        setTimeout(() => {
          toast.style.opacity = '0';
          setTimeout(() => toast.remove(), 300); // 等过渡完成后移除
        }, 3000);
      }

      formatMinOneDecimal(num) {
        const rounded = Math.round(num * 10) / 10; // 保留1位小数，四舍五入
        return Math.max(rounded, 0.1);             // 最小值限制为 0.1
      }

      initTabClick() {
        const tabItems = this.wrapper.querySelectorAll('.expenditures-tab-item');
        if (!tabItems.length) return;

        tabItems.forEach((item, index) => {
          if (item.classList.contains('active')) {
            this.clickedTabIndex = Array.from(tabItems).indexOf(item);
            this.clickedTabTxt = item.innerText;
          }
          item.addEventListener('click', () => {
            // 移除所有的 active
            tabItems.forEach(tab => tab.classList.remove('active'));
            // 当前项加上 active
            item.classList.add('active');
            // 记录下标
            this.clickedTabIndex = index;
            this.clickedTabTxt = item.innerText;

          });
        });
      }

      initBtnClick() {
        const btn = this.wrapper.querySelector('.expenditures-btn');
        if (!btn) return;

        btn.addEventListener('click', () => {
          const lebel = this.wrapper.querySelector('.expenditures-dispatch-top span');
          const priceEl = this.wrapper.querySelector('.expenditures-dispatch-product-item .n-price');
          const inputEl = this.wrapper.querySelector('.expenditures-num');
          const price = parseFloat(priceEl?.innerText.replace(/[^0-9.]/g, '') || "0");
          const expenditure = parseInt(inputEl?.value || "0", 10);

          if (isNaN(expenditure) || expenditure <= 0) {
            this.showToast("Please enter a valid expense amount");
            return;
          }
          lebel.innerText = `${this.clickedTabTxt} (£${expenditure} / month)`;
          this.wrapper.querySelector('.expenditures-cont').style.display = 'none';
          this.wrapper.querySelector('.expenditures-dispatch').style.display = 'block';
          this.calculateReturnInfo(price, expenditure);
          this.initSwiper();
          // 根据 tab 下标激活对应的 dispatch-item
          const dispatchItems = this.wrapper.querySelectorAll('.expenditures-dispatch-item');
          if (dispatchItems.length && typeof this.clickedTabIndex === 'number') {
            dispatchItems.forEach((item, index) => {
              if (index === this.clickedTabIndex) {
                item.classList.add('active');
              } else {
                item.classList.remove('active');
              }
            });
          }
        });
      }

      initResetBtn() {
        const resetBtn = this.wrapper.querySelector('.expenditures-dispatch-btn');
        const inputEl = this.wrapper.querySelector('.expenditures-num');

        if (!resetBtn || !inputEl) return;

        resetBtn.addEventListener('click', () => {

          this.wrapper.querySelector('.expenditures-cont').style.display = 'block';
          this.wrapper.querySelector('.expenditures-dispatch').style.display = 'none';
          // 清空输入框
          // inputEl.value = '';
          inputEl.focus();


        });
      }

      calculateReturnInfo(productPrice, monthlySpend) {
        const resultMonthEl = this.wrapper.querySelector('.expenditures-dispatch-m');
        const resultSaveEl = this.wrapper.querySelector('.expenditures-dispatch-y');

        if (!resultMonthEl || !resultSaveEl) return;

        const returnMonths = this.formatMinOneDecimal(productPrice / monthlySpend);
        const yearlySavings = monthlySpend * 12;

        resultMonthEl.querySelector('strong').innerText = `${returnMonths} months`;
        resultSaveEl.querySelector('strong').innerText = `save up to £${yearlySavings.toLocaleString()}/year`;

      }

      recalculateWithNewPrice(newPrice) {
        const input = this.wrapper.querySelector(".expenditures-num");
        const expenditure = parseInt(input?.value || "0", 10);
        if (!isNaN(newPrice) && expenditure > 0) {
          this.calculateReturnInfo(newPrice, expenditure);
        }
      }
    }

    // 初始化
    new ExpendituresController('.expenditures');


  </script>
</body>

</html>